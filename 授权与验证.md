# Authentication 授权验证
## Program.cs
```C#
var builder = WebApplication.CreateBuilder(args);
var connectionString = builder.Configuration.GetConnectionString("DbContext");
builder
  .Logging
  .AddConsole()
  .Services
  .AddGateawayAuthentication(option =>
    {
        option.HeaderName = "Security-Auth";//header 名称
        option.Exclude = new string[] { "mine.sign", "account.reg", "set.get" };//排除验证的,method
        option.ExpiredTime = TimeSpan.FromDays(2);//验证过期时间
      //SecurityKey : 用于加密的密钥
      //GenerateAccessToken (Func<string, string>) : accessToken生成,输入明文返回accesstoken
      //ReverseAccessToken  (Func<string, string>) : 反向解析accessToken 为明文
    })
  .AddGateaway();
var app = builder.Build();
app.
    .UseGateawayAuthentication() //添加验证服务
    .UseGateaway();
app.Run("http://*:5000");
```
## 登录
```C#
public class UserGateaway:GateawayBase
{
    ILogger<UserGateaway> Logger { get; }
    DataContext Db { get; }
    public UserGateaway(DataContext context,ILogger<UserGateaway> logger)
    {
        Logger=logger;
        Db = context;
    }
    //路由 :user.sign 或者 /user/sign 建议采用json: {method:"user.sign",loginName:"",loginPassword:""}
    // 需要将该路由配置到排除授权访问列表 或者添加 [AllowAnyone] 属性
    public async Task<object> Sign(string loginName,string loginPassword){
       //...判断登录账户,密码
        var accessToken=SignIn(userid,username,roleid,rolename,propertys);//base.SignIn
        // 前端访问需要将 accessToken 放入header中 进行授权
        return Success(new{
          token=accessToken,
          user
        });
    }
    //获取用户手机号
    //默认 user.phone
    public async Task<object> Phone(){
        var user=Db.Accounts.Find(User.Id);//Base.User 当前登录的用户
        ...
    }
    // 修改用户手机号
    // user.phone.update
    [Gateaway(Name = "phone.update", Display = "更新用户手机号")]
    public async Task<object> PhoneUpdate(string phone){
        ...
    }
}

```
